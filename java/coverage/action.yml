name: 'MA Java CI Coverage'
description: 'A collection of common java jobs and cache operations'
runs:
  using: "composite"
  steps:
    - uses: actions/checkout@v3
    - name: Download artifect from test results
      uses: actions/download-artifact@v3
      with:
        name: test-results
    - name: Find files
      shell: bash
      run: echo "files=$(find . -type f -regex ".*/reports/jacoco/test/jacocoTestReport.xml" | paste -s -d ',' -)" >> $GITHUB_ENV
    - name: Run DeepSource Reporter
      shell: bash
      run: |
            # Install the CLI
            curl https://deepsource.io/cli | sh
            # Send the report to DeepSource
            find . -type f -regex ".*/reports/jacoco/test/jacocoTestReport.xml" -exec ./bin/deepsource report --analyzer test-coverage --key java --value-file {}

